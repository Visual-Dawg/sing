<script lang="ts">
  import IconFolderRemove from "virtual:icons/heroicons-outline/folder-remove"
  import IconFolderAdd from "virtual:icons/heroicons-outline/folder-add"
  import { createEventDispatcher } from "svelte"
  import { testAttr } from "@/TestConsts"

  export let path: string | undefined = undefined
  export const symbol = Symbol(`folder-${path}`)

  const dispatch = createEventDispatcher()

  async function pickFolder() {
    const { filePaths, canceled } = await window.api.openMusicFolder()

    if (canceled || filePaths.length === 0) return null

    return filePaths
  }

  async function handleClick() {
    if (path === undefined) {
      addNewFolder()
    } else {
      editFolder()
    }
  }

  async function addNewFolder() {
    const folderPaths = await pickFolder()
    if (folderPaths === null) return

    dispatch("folderAdded", folderPaths)
  }

  async function dispatchRemove() {
    dispatch("folderRemoved", path)
  }

  async function editFolder() {
    const newPaths = await pickFolder()
    if (newPaths === null) return

    dispatch("folderEdited", { oldPath: path, newPaths })
  }
</script>

<button
  data-testattribute={testAttr.folderInput}
  class="
			group  flex
			h-12  w-full place-content-between  items-center
			rounded-xl border
			border-grey-300 pl-3
			text-left transition-colors
			duration-100 ease-out hover:border-grey-200
      hover:text-white
			"
  on:click={() => handleClick()}
>
  <div class="mr-6">{path ?? "Add folderâ€¦"}</div>

  {#if path}
    <div
      data-testattribute={testAttr.folderInputDeleteIcon}
      class="h-12 p-3 text-grey-200 hover:text-orange-500"
      on:click|stopPropagation={dispatchRemove}
    >
      <IconFolderRemove class="h-6 w-6 " />
    </div>
  {:else}
    <div class="pr-3">
      <IconFolderAdd class="h-6 w-6" />
    </div>
  {/if}
</button>
